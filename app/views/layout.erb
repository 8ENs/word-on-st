<!DOCTYPE html>
<html lang="en">
<head>
<!-- <meta name='csrf-token' content='<%= session[:csrf] %>'> -->
  <!--
    normalize.css removes cross-browser differences in defaults, e.g.,
    differences in how form elements appear between Firefox and IE
    See: http://necolas.github.com/normalize.css/
  -->
  <!-- <link rel="stylesheet" href="/stylesheets/normalize.css"> -->
  <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
  <!--
    application.css is where you put your styles
  -->
  <link rel="stylesheet" href="/stylesheets/application.css">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <!-- <script src="/javascripts/modernizr.js"></script>
  <script src="/javascripts/geoPosition.js"></script> -->


  <title>Word on the Street</title>
</head>
<body>

<!-- <nav class="navbar navbar-default"> -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <!-- <div class="navbar-header"> -->

      <a class="navbar-brand" href="/">Word on the Street (click here for MAIN)</a>

        <div class="navbar-text navbar-right">
          <% if user_logged_in? %>
            Signed in as <a href="/users/<%= session[:id] %>" class="navbar-link"><%= get_current_user.name %></a>
            <a href="<%= url_for(:session, :logout) %>" class="btn btn-primary">logout</a>
          <% else %>
            <a href="/register">register</a>
            <a href="<%= url_for(:session, :login) %>" class="btn btn-primary">login</a>
          <% end %>
        </div>

      </a>
    <!-- </div> -->
  </div>
</nav>

<div class="container">
  <div >
  
</div>
  <div id="tripmeter" class="row">
    <div class="col-md-8">
      <img src="/images/default_map.jpg" style="fixed: left">
    </div>
  
    <div class="col-md-4">
      <p>
        Starting Location (lat, lon):<br/>
        <span id="startLat">???</span>&deg;, <span id="startLon">???</span>&deg;
      </p>
      <p>
        Current Location (lat, lon):<br/>
        <span id="currentLat">???</span>&deg;, <span id="currentLon">???</span>&deg;
      </p>
      <p>
        Distance from starting location:<br/>
        <span id="distance">0</span> km
      </p>
      <p style="color: red">
        I've just embedded the source files from <a href="http://www.html5rocks.com/en/tutorials/geolocation/trip_meter">this page</a> for now. It does keep watching so if you move there's relativity in position. If this works, we'll just need to capture the lat/lon and store in Mongo. Map on the left is a static/placeholder. It's also reloading on every hyperlink click which is overkill. Clean it up boys! 8)
    </div>
  </div>
  <script>
    window.onload = function() {
      var startPos;
    
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          startPos = position;
          document.getElementById("startLat").innerHTML = startPos.coords.latitude;
          document.getElementById("startLon").innerHTML = startPos.coords.longitude;
        }, function(error) {
          alert("Error occurred. Error code: " + error.code);
          // error.code can be:
          //   0: unknown error
          //   1: permission denied
          //   2: position unavailable (error response from locaton provider)
          //   3: timed out
        });
    
        navigator.geolocation.watchPosition(function(position) {
          document.getElementById("currentLat").innerHTML = position.coords.latitude;
          document.getElementById("currentLon").innerHTML = position.coords.longitude;
          document.getElementById("distance").innerHTML =
            calculateDistance(startPos.coords.latitude, startPos.coords.longitude,
                              position.coords.latitude, position.coords.longitude);
        });
      }
    };
    
    // Reused code - copyright Moveable Type Scripts - retrieved May 4, 2010.
    // http://www.movable-type.co.uk/scripts/latlong.html
    // Under Creative Commons License http://creativecommons.org/licenses/by/3.0/
    function calculateDistance(lat1, lon1, lat2, lon2) {
      var R = 6371; // km
      var dLat = (lat2-lat1).toRad();
      var dLon = (lon2-lon1).toRad();
      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      var d = R * c;
      return d;
    }
    Number.prototype.toRad = function() {
      return this * Math.PI / 180;
    }
  </script>

  <hr/>

  <%= yield %>
</div>
<!-- <nav>
<ul class="nav nav-pills nav-justified">
  <li><a href="/users">USERS (later DROP)</a></li>
  <li><a href="/pins"><li>EXPLORE</a></li>
</ul>
</nav> -->

<nav class="navbar navbar-default navbar-fixed-bottom">
  <div class="container">

        <div class="navbar-text navbar-center">
            <a href="/pins" class="btn btn-primary">EXPLORE</a>
            <% if user_logged_in? %>
              <a href="/pins/new" class="btn btn-primary">DROP</a>
            <% else %>
              <a href="/pins/new" class="btn btn-primary disabled">DROP</a>
            <% end %>
        </div>

      </a>
  </div>
</nav>


<!-- <script src="geoPosition.js"></script> -->
</body>
</html>
